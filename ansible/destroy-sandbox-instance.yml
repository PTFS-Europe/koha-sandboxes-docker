---
-
  hosts: all
  become: true

  handlers:
    -
      name: "Restart apache"
      service: "name=apache2 state=restarted"

  tasks:
    - debug:
        msg: "Using '{{ instance_name }}' as instance name"

    - name: Remove koha-testing-docker container
      docker_container:
        name: "koha-{{ instance_name }}"
        state: absent
        force_kill: yes

    - name: Delete database for Koha instance
      mysql_db:
        name: "koha_{{ instance_name }}"
        state: absent
        login_host: 127.0.0.1
        login_port: 3306
        login_user: root
        login_password: password

    - name: Delete database use for Koha instnace
      mysql_user:
        name: "koha_{{ instance_name }}"
        state: absent
        login_host: 127.0.0.1
        login_port: 3306
        login_user: root
        login_password: password

    - name: "Delete sandbox instance koha git clone"
      file:
        path: /usr/local/src/koha-sandboxes/{{ instance_name }}
        state: absent

    - name: "Remove apache config for sandbox instance"
      file:
        path: /etc/apache2/sites-enabled/{{ instance_name }}.conf
        state: absent
      notify: "Restart apache"
